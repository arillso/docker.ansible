---
- name: Final Deployment Validation
  hosts: all
  gather_facts: true
  tasks:
      - name: "Deployment Test"
        ansible.builtin.debug:
            msg: "Ansible Deployment Test successful: {{ test_var }}"

      - name: "Check Environment"
        ansible.builtin.command: env
        register: env_output
        changed_when: false

      - name: "Check Installed Ansible Modules"
        ansible.builtin.command: ansible-doc -l
        register: modules
        changed_when: false

      - name: "Save Test Results"
        ansible.builtin.copy:
            content: |
                ANSIBLE DEPLOYMENT TEST RESULTS
                ===============================
                Date: {{ ansible_date_time.iso8601 }}
                Python: {{ ansible_python.version.major }}.{{ ansible_python.version.minor }}.{{ ansible_python.version.micro }}
                Ansible: {{ ansible_version.full }}

                Available Modules: {{ modules.stdout_lines | length }}
            dest: "/tmp/deployment-test-results.txt"
            mode: "0644"
